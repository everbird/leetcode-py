#!/usr/bin/eni python
# encoding: utf-8

class Solution(object):
    def longestIncreasingPath(self, matrix):
        ans = 0
        if not matrix:
            return ans

        dx = [0, 1, 0, -1]
        dy = [1, 0, -1, 0]
        len_y = len(matrix)
        len_x = len(matrix[0])
        starts = set([(i, j) for j in range(len_y) for i in range(len_x)])
        while starts:
            x, y = starts.pop()
            paths = go(matrix, x, y, len_x, len_y, starts)
            ans = max(ans, max(map(len, paths) or [0]))

        return ans



def go(matrix, x, y, len_x, len_y, starts):
    this_val = matrix[y][x]

    max_length = 0
    ret = []
    for direction in range(4):
        dx, dy = get_direction(direction)
        nx = x+dx
        ny = y+dy
        if 0 <= nx < len_x and 0 <= ny < len_y:
            next_val = matrix[ny][nx]
            if next_val > this_val:
                if (nx, ny) in starts:
                    starts.remove((nx, ny))
                paths = go(matrix, x+dx, y+dy, len_x, len_y, starts)
                for path in paths:
                    ret.append([this_val]+path)
                    max_length = max(max_length, len(path)+1)

    if not ret:
        ret.append([this_val])
    else:
        ret = [p for p in ret if len(p) == max_length]

    return ret


def get_direction(n):
    dx = [0, 1, 0, -1]
    dy = [1, 0, -1, 0]
    return dx[n], dy[n]


if __name__ == '__main__':
    s = Solution()

    tests = [
        (
            [
                [9,9,4],
                [6,6,8],
                [2,1,1]
            ],
            4
        ),
        (
            [[56,72,42,85,80,41,38,72,45,63,59,77,95,78,84,92,75,17,90,54,21,87,2,93,58,88,59,6,0,10,95,54,96,33,42,17,86,36,37,55,27,76,98,44,86,32,69,60,53,46,92,32,66,65,5,64],[11,90,48,90,37,33,64,60,50,82,27,94,82,93,29,27,45,52,51,78,3,68,28,16,68,80,25,37,91,14,99,97,93,74,61,34,24,68,38,20,86,34,68,9,5,56,7,10,68,97,17,82,3,67,54,94],[26,54,20,18,68,50,65,36,59,4,10,51,63,8,0,67,15,60,58,0,41,60,29,9,58,21,25,72,3,76,33,63,99,98,99,9,81,70,69,88,2,68,91,23,24,80,54,65,10,30,34,61,27,61,21,3],[71,22,63,84,49,64,95,66,48,22,40,56,53,98,6,1,65,85,3,16,25,32,61,61,46,70,58,54,88,35,51,77,70,70,59,58,91,58,39,93,32,60,8,22,30,1,65,61,33,69,31,0,24,45,32,28],[40,89,34,57,70,19,69,79,16,34,64,94,99,83,46,45,40,94,82,71,47,59,8,98,54,35,3,33,99,66,91,21,59,80,32,5,19,17,41,52,72,10,39,33,31,50,19,85,88,49,3,79,24,8,50,73],[47,22,35,2,12,20,14,58,40,53,26,55,25,36,70,69,19,22,81,53,26,75,42,26,99,85,12,26,85,5,39,81,84,35,22,24,61,34,6,33,18,25,73,77,90,24,73,6,60,50,51,88,27,51,79,0],[53,18,50,13,6,98,84,11,2,63,5,1,48,40,86,90,62,79,81,40,52,54,56,46,4,77,76,21,68,61,43,70,64,32,32,94,91,70,35,39,45,88,88,43,4,7,38,50,87,25,21,29,21,61,81,82],[58,97,58,44,72,89,97,29,21,6,93,19,17,49,30,76,92,27,87,36,73,34,27,13,2,90,47,67,91,1,79,6,11,45,75,45,91,60,81,37,10,58,68,67,66,36,5,99,4,52,54,38,6,70,88,43],[98,54,85,62,4,31,19,25,43,60,53,13,92,50,75,33,19,43,74,26,75,42,51,32,60,39,72,64,1,62,69,75,68,24,92,54,83,30,16,84,97,51,60,58,41,5,80,2,91,40,87,48,24,3,47,6],[65,8,94,42,73,74,98,34,20,37,84,95,31,99,34,27,77,35,78,18,73,39,27,64,79,2,34,90,85,0,40,50,54,38,16,25,6,19,68,59,17,66,36,34,94,25,49,25,8,62,97,24,68,52,76,62],[50,2,1,2,18,8,83,63,48,23,38,7,88,80,26,7,55,49,97,10,87,97,42,15,66,29,42,32,74,99,40,25,89,70,66,38,16,44,50,47,22,42,15,62,31,90,96,34,40,75,19,74,26,21,4,29],[66,0,65,50,59,0,70,25,95,59,30,53,57,7,40,24,21,38,1,12,23,44,94,88,29,84,22,32,47,8,75,94,28,63,70,11,31,8,90,77,81,77,69,7,62,58,49,50,92,0,6,3,8,31,85,48],[80,84,6,19,61,35,48,31,66,30,56,25,86,46,57,54,27,92,18,20,40,80,10,18,52,57,82,30,10,30,88,15,17,31,50,24,94,93,89,51,65,88,97,62,56,51,85,68,68,88,86,88,1,61,74,4],[85,23,55,22,33,49,48,44,99,61,23,13,37,11,52,32,19,91,27,93,61,74,64,14,96,56,66,44,59,30,17,68,70,59,79,53,89,17,31,44,59,13,61,28,46,7,85,67,52,97,78,62,97,3,98,65],[0,62,43,59,92,14,0,73,83,29,44,33,70,9,35,95,52,77,60,27,81,28,74,99,59,4,20,21,20,75,65,48,60,81,32,32,54,17,37,32,89,21,8,92,96,37,8,8,55,43,60,76,86,47,77,98],[41,22,79,90,78,77,35,9,83,20,47,41,39,8,31,60,4,82,83,32,99,34,36,84,39,41,12,18,1,19,86,81,30,96,48,97,43,78,23,57,49,12,90,78,45,87,3,55,47,94,39,32,35,19,57,31],[57,93,49,85,26,89,7,19,84,74,51,23,27,37,54,67,99,30,3,61,82,92,98,90,3,20,62,20,36,89,22,64,17,96,3,10,53,0,30,70,70,20,92,75,59,26,38,89,17,32,50,23,56,66,93,28],[99,99,41,93,95,87,35,72,97,6,50,63,15,12,38,79,42,62,34,41,89,54,93,72,62,87,97,37,26,90,64,55,67,65,52,5,70,70,57,19,4,83,21,42,50,18,31,93,48,52,47,97,54,49,70,0],[67,23,46,98,79,78,61,72,37,92,55,10,94,37,75,60,48,59,89,42,15,21,74,14,45,6,29,99,83,57,22,44,7,88,30,9,5,54,50,22,46,81,21,15,0,88,29,44,77,58,58,23,46,10,70,15],[49,44,57,51,42,56,8,17,35,17,69,16,19,64,54,18,9,76,99,36,30,4,19,15,72,48,48,9,43,36,99,23,83,81,14,70,88,18,4,50,62,36,23,55,45,58,13,52,24,9,65,73,42,96,22,32],[5,28,67,44,47,11,77,39,95,95,86,47,54,86,14,72,93,88,99,36,82,68,56,63,7,84,19,86,82,25,65,8,63,12,30,65,68,36,61,23,19,12,91,70,82,64,47,11,36,80,83,93,96,25,57,33],[63,89,53,80,51,6,28,31,67,46,26,78,43,2,78,86,56,69,22,71,22,21,74,46,45,65,5,80,98,82,47,83,67,84,78,5,2,71,60,52,20,12,75,77,81,82,36,86,24,87,30,34,92,96,67,30],[91,0,77,23,24,45,31,20,12,36,19,11,58,25,4,56,59,72,77,49,52,91,56,28,35,8,73,43,58,65,11,71,76,11,89,21,78,53,15,58,82,23,20,57,86,87,88,47,15,11,7,14,18,85,1,19],[64,25,37,83,7,77,52,25,16,19,83,2,64,23,2,1,72,76,49,35,44,58,92,68,37,45,10,12,41,29,27,85,20,62,47,16,6,39,13,3,4,4,32,83,74,65,28,11,70,6,93,5,90,5,25,36],[32,42,26,76,99,50,50,86,50,71,83,96,17,72,51,81,32,26,28,70,84,27,42,62,29,2,89,31,66,16,62,10,5,18,27,4,70,21,83,92,43,23,85,30,94,67,75,45,59,45,7,89,46,20,42,6],[69,76,85,30,79,44,7,79,23,65,29,50,80,21,57,57,59,84,84,22,95,61,66,13,74,97,13,34,28,12,82,17,97,80,1,29,24,44,9,19,75,47,59,37,60,66,40,9,37,48,97,48,67,65,48,54],[16,61,37,99,10,79,38,73,30,62,21,84,7,17,15,38,65,43,70,21,21,45,65,46,1,5,60,77,2,7,11,87,82,91,36,35,41,91,13,54,19,38,16,3,27,50,9,31,87,15,90,86,49,98,94,70],[40,5,77,43,56,40,49,77,43,85,42,35,75,85,42,14,33,80,71,78,60,47,51,71,92,37,67,92,55,55,73,49,17,26,96,16,0,43,33,8,4,65,38,49,85,83,8,47,91,92,90,85,54,65,50,13],[38,38,60,48,38,90,58,20,77,22,16,55,88,57,3,91,60,49,34,27,59,68,60,61,58,9,81,24,45,96,73,38,78,59,83,36,80,51,55,7,84,30,66,72,39,13,48,23,12,30,52,79,53,13,64,22],[89,1,99,44,1,42,12,54,31,14,66,62,32,77,90,86,21,58,98,39,41,71,63,15,67,68,69,27,60,49,67,15,77,74,2,44,61,57,76,33,89,32,98,77,70,96,55,60,17,34,27,41,38,84,80,77],[90,43,17,82,2,29,41,35,13,90,68,16,51,45,76,66,73,1,78,37,90,89,4,90,71,29,79,64,70,3,27,15,20,19,75,84,49,23,55,20,94,87,86,72,74,65,56,54,51,77,32,66,23,43,51,36],[64,5,68,50,93,64,25,93,10,44,4,38,83,26,80,79,92,62,35,0,11,21,20,48,62,99,74,49,59,38,67,89,75,61,3,34,23,60,97,57,88,58,36,66,9,27,48,72,66,55,57,53,4,58,77,5],[19,93,85,8,49,51,16,30,76,80,68,76,92,95,71,8,49,60,19,50,16,49,68,74,0,98,10,29,42,55,58,69,49,54,32,45,49,90,95,22,85,24,71,0,24,36,4,69,57,56,33,25,2,9,46,78],[71,59,19,74,13,60,95,15,69,21,81,87,55,21,59,83,32,55,31,22,92,83,31,70,45,32,37,83,89,85,81,3,47,6,7,35,85,86,16,48,46,99,38,14,75,63,20,26,61,22,25,70,38,93,52,84],[57,53,5,36,39,12,98,42,3,71,8,72,38,81,58,40,49,1,28,30,46,57,59,62,33,77,21,69,11,69,35,99,88,40,83,4,94,35,18,39,3,77,88,37,12,27,40,70,78,1,3,68,26,29,6,97],[95,52,35,90,35,3,65,18,91,19,27,39,25,29,62,34,61,62,80,50,4,6,58,63,92,52,7,6,44,18,23,32,40,11,10,85,82,92,45,62,49,99,47,30,27,43,78,30,22,24,20,44,72,46,45,87],[55,18,39,38,72,97,58,86,44,66,19,78,89,99,7,90,39,76,89,64,38,4,76,68,13,8,20,61,9,26,96,81,88,15,93,67,6,53,69,4,66,65,98,89,66,33,72,19,44,14,38,49,29,84,70,23],[3,63,79,11,68,26,51,6,99,23,11,73,10,71,90,42,22,56,3,26,54,89,55,81,17,41,86,25,64,4,79,84,27,3,22,45,83,19,15,70,83,53,61,24,73,78,88,80,17,14,86,42,30,99,4,60],[45,96,29,92,10,71,47,23,62,17,93,15,27,68,14,76,44,87,85,20,97,22,24,25,63,37,58,24,48,84,39,19,97,69,42,34,53,66,59,7,3,97,20,86,45,30,46,1,15,20,53,49,15,88,52,81],[27,63,12,88,94,87,61,71,56,98,14,36,88,20,17,73,44,74,31,44,67,24,23,89,92,75,2,48,16,23,82,22,94,13,92,70,54,37,97,71,95,21,17,24,59,81,48,9,21,94,41,83,27,42,55,79],[90,33,92,92,94,16,66,14,7,48,58,58,22,57,3,12,65,12,55,92,58,26,37,63,59,28,51,85,23,21,16,96,34,11,11,41,46,34,54,46,10,86,61,72,16,96,83,46,19,88,52,35,97,10,98,26],[57,55,57,72,65,84,17,32,99,23,30,55,49,6,84,77,65,12,59,1,54,61,42,48,89,9,7,33,72,62,42,18,60,97,75,51,96,68,51,34,74,38,3,62,41,66,19,20,33,38,86,3,79,68,55,67],[22,23,5,3,43,9,53,57,52,16,68,31,99,12,44,31,14,72,92,22,76,53,96,99,85,91,31,8,70,42,83,59,43,26,26,67,90,71,80,33,28,46,58,94,52,72,90,18,84,65,22,16,29,52,41,45],[7,21,89,51,9,46,48,55,87,2,70,27,9,9,89,62,53,25,27,69,34,9,77,49,83,45,36,27,83,5,20,71,3,19,10,12,35,92,12,84,66,87,84,30,64,47,62,98,50,86,43,37,0,50,55,45],[56,51,87,30,64,20,57,73,82,20,84,55,47,49,46,10,49,20,46,92,35,15,23,23,59,41,0,9,12,28,94,1,95,9,36,43,54,76,10,10,35,70,0,45,55,73,67,68,72,47,98,33,82,99,15,97],[90,54,8,41,69,78,85,51,71,29,21,2,55,97,1,83,83,55,86,44,70,26,78,31,58,82,13,45,89,67,77,26,88,81,16,53,7,72,25,48,4,73,6,81,30,16,25,16,66,4,97,10,44,95,99,27],[40,55,70,88,77,2,60,7,0,5,28,97,50,27,4,47,31,15,37,5,94,60,26,44,23,78,30,38,5,17,10,23,73,32,39,55,64,64,57,87,95,48,96,90,70,19,28,38,28,44,64,7,89,9,5,12],[90,39,2,60,41,22,52,16,94,14,34,81,27,98,42,32,48,12,16,7,54,90,72,58,58,48,4,58,50,56,89,67,48,44,58,12,20,33,71,38,47,53,88,9,14,43,86,71,13,15,91,83,36,62,93,90],[77,43,89,10,57,16,26,75,49,1,65,95,66,23,70,24,74,65,80,9,10,11,37,20,18,31,54,72,31,91,70,20,94,37,63,3,78,90,5,74,64,41,58,23,71,95,66,3,2,34,80,45,93,83,72,42],[0,57,17,9,67,72,39,29,45,82,85,49,13,41,44,48,90,86,88,74,63,98,97,19,77,84,78,95,21,27,98,66,6,70,7,43,52,85,68,52,81,18,52,5,94,10,5,42,22,35,24,47,58,35,38,47],[87,39,43,28,88,65,63,40,49,84,86,16,71,55,78,22,15,1,88,89,73,56,76,52,61,87,90,34,68,54,53,8,13,34,67,37,48,35,36,23,53,40,28,70,54,93,96,79,78,26,57,99,50,71,23,46],[10,16,77,83,97,16,87,98,35,95,42,57,43,37,31,28,21,29,10,79,58,43,54,50,51,79,46,90,77,36,76,67,18,24,26,66,89,60,11,16,28,36,11,56,23,30,7,58,5,93,52,89,39,26,33,24],[21,82,13,74,34,98,71,20,64,68,46,71,60,99,21,79,76,99,51,14,78,58,61,30,23,59,97,55,5,34,83,69,5,88,0,95,41,69,26,24,33,44,87,23,42,48,45,74,69,50,6,67,14,34,98,0],[28,3,74,53,4,5,58,60,71,38,76,41,26,74,91,76,89,56,13,65,12,44,0,42,40,70,68,92,29,41,51,64,54,56,47,92,33,37,58,47,78,82,40,5,17,9,1,60,26,36,38,17,64,37,45,55]],
            11
        ),
        (
            [[0,1,2,3,4,5,6,7,8,9],[19,18,17,16,15,14,13,12,11,10],[20,21,22,23,24,25,26,27,28,29],[39,38,37,36,35,34,33,32,31,30],[40,41,42,43,44,45,46,47,48,49],[59,58,57,56,55,54,53,52,51,50],[60,61,62,63,64,65,66,67,68,69],[79,78,77,76,75,74,73,72,71,70],[80,81,82,83,84,85,86,87,88,89],[99,98,97,96,95,94,93,92,91,90],[100,101,102,103,104,105,106,107,108,109],[119,118,117,116,115,114,113,112,111,110],[120,121,122,123,124,125,126,127,128,129],[139,138,137,136,135,134,133,132,131,130],[0,0,0,0,0,0,0,0,0,0]],
            -1
        )
    ]
    f = s.longestIncreasingPath
    for input_args, expected in tests:

        if isinstance(input_args, tuple):
            r = f(*input_args)
        else:
            r = f(input_args)
        print 'Result:{}\tInput:{}\tOutput:{}\tExpected:{}'.format(r == expected, input_args, r, expected)
